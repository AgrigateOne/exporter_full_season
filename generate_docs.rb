# frozen_string_literal: true

# rubocop:disable Metrics/ClassLength
# rubocop:disable Metrics/MethodLength

###########################################################################
### This script takes a list of invoice refs and generates them as pdfs ###
###########################################################################

# Run at Unifrutti:
# JASPER_REPORTS_PATH=/home/unifrutti/unifrutti_exporter/jasper_resources/unifrutti \
# GENERATED_REPORT_PATH=/home/unifrutti/output \
# JRUBY_JASPER_HOST_PORT=172.16.0.17:9996 \
# bundle exec ruby generate_docs.rb

require 'bundler'
Bundler.require(:default, 'development')

require 'drb/drb'
require 'sequel'
require 'logger'

# DATABASE_URL = 'postgres://postgres:postgres@localhost/exporter'
DATABASE_URL = 'postgres://postgres:postgres@172.16.0.247/exporter'
# DATABASE_URL = 'postgres://nss:f-knW;nfB2@localhost/exporter'

DB = Sequel.connect(DATABASE_URL)
Sequel.application_timezone = :local
Sequel.database_timezone = :utc

# Generate a file or print from a Jasper report.
#
# To run:
#     jasper_params = JasperParams.new('adc', current_user.login_name, param1: 'val', param2: 123)
#     CreateJasperReport.call(jasper_params)
#
# The report is generated with the following default parameters which can be overridden (e.g. jasper_param.mode = :xls)
# - mode: :pdf. Can be :rtf, :xls, :csv or :print.
# - file_name: Same as report_name. Th00is is the name of the output file without extension.
# - parent_folder: nil. Set this to the value of ClientSettings.jasper_client_dir when a report is in a client's subdir.
# - printer: nil. In :print mode, this MUST be provided.
# - return_full_path: false. Set to true to return the full path to the file so it can e.g. be attached to an email.
#
class CreateJasperReport
  attr_reader :jasper_params, :parent_folder, :repo

  JASPER_DB_OPTIONS = DB.opts.select { |k, _| %i[user password port host database].include?(k) }

  FILE_TYPES = {
    pdf: 'pdf',
    xls: 'xlsx',
    rtf: 'rtf',
    csv: 'csv'
  }.freeze

  class << self
    def call(*args)
      new(*args).call
    end
  end

  def initialize(jasper_params)
    @jasper_params = jasper_params
    @parent_folder = jasper_params.parent_folder
    @output_file = add_output_path
    @file_type = FILE_TYPES[jasper_params.mode]
  end

  def call
    # log_report_details
    output = generate_report

    if output[:success]
      handle_success(output)
    else
      handle_failure(output)
    end
  end

  private

  def handle_success(output)
    # log_report_result(output)
    save_file(output)
    { success: true, msg: 'Report has been generated', instance: download_file }
  end

  def handle_failure(output)
    log_error(output)
    log_report_result(output)
    { success: false, msg: "Jasper printing error: <br>#{output[:msg]}" }
  end

  def generate_report
    generate_report_string(jasper_params.user_name,
                           jasper_params.report_name,
                           report_dir,
                           jasper_params.mode,
                           jasper_params.params)
  end

  def save_file(output)
    file = "#{@output_file}.#{@file_type}"
    File.open(file, 'w') { |f| f << output[:doc] }
  end

  def log_error(result) # rubocop:disable Metrics/AbcSize
    e_type = result[:error_type] ? "#{result[:error_type]}: " : ''
    trace = result[:backtrace] ? "\n\n#{result[:backtrace].join("\n")}" : ''
    body = <<-STR
      Jasper report "#{jasper_params.report_name}" did not succeed.

      Error  : #{e_type}#{result[:msg]}

      User   : #{jasper_params.user_name}

      Mode   : #{jasper_params.mode}

      Params : #{jasper_params.params.inspect}

      Result : #{result}
      #{trace}
    STR
    puts "Jasper error for #{jasper_params.report_name}\n#{body}"
  end

  def download_file
    "#{@output_file}.#{@file_type.downcase}"
  end

  def log_report_details
    puts "--- JASPER REPORT : #{jasper_params.report_name} :: #{Time.now}"
    puts "USER   : #{jasper_params.user_name}"
    puts "MODE   : #{jasper_params.mode}"
    puts "PARAMS : #{jasper_params.params.inspect}"
    puts '-'
  end

  def log_report_result(result)
    puts "RESULT : #{result[:msg]}"
    puts '---'
  end

  def report_dir
    @report_dir ||= ENV['JASPER_REPORTS_PATH']
  end

  def add_output_path
    File.join(ENV['GENERATED_REPORT_PATH'], jasper_params.file_name)
  end

  def host_port
    ENV['JRUBY_JASPER_HOST_PORT']
  end

  def generate_report_string(user, report, path, mode, params)
    DRb.start_service
    remote_object = DRbObject.new_with_uri("druby://#{host_port}")
    res = remote_object.make_jasper_report(user,
                                           report,
                                           path,
                                           mode,
                                           JASPER_DB_OPTIONS,
                                           params || {})

    DRb.stop_service
    res
  rescue DRb::DRbConnError => e
    raise "The Jasper service is not reachable at #{host_port} : #{e.message}"
  ensure
    DRb.stop_service
  end

  def db_opts
    @db_opts ||= begin
      conn_params = Globals.jasper_reports_conn_params
      { user: conn_params[:username],
        password: conn_params[:password],
        port: conn_params[:port],
        host: conn_params[:host],
        database: conn_params[:database] }
    end
  end
end

# Gather settings for a Jasper Report and apply defaults.
class JasperParams
  attr_reader :report_name, :user_name, :params
  attr_accessor :file_name, :mode, :parent_folder, :printer, :return_full_path, :custom_output_dir

  def initialize(report_name, user_name, params = {})
    @report_name = report_name
    @user_name = user_name
    @params = params
    setup_defaults
  end

  def to_s
    <<-TXT
    Jasper params
    -------------------------------------
    REPORT:        #{report_name}
    USER:          #{user_name}
    PARAMS:        #{params.inspect}
    MODE:          #{mode}
    FILE_NAME:     #{file_name}
    PARENT_FOLDER: #{parent_folder}
    PRINTER:       #{printer}
    FULL PATH?     #{return_full_path}
    CUSTOM OUT DIR:#{custom_output_dir}
    TXT
  end

  private

  def setup_defaults
    @mode = :pdf
    @file_name = report_name
    @parent_folder = nil
    @printer = nil
    @return_full_path = false
    @custom_output_dir = nil
  end
end

# ------------------------------------------------------------

def print_invoice(inv_ref) # rubocop:disable Metrics/AbcSize
  sql = <<~SQL
    SELECT i.approved,
    i.approved_by,
    i.id,
    LOWER(i.invoice_type) AS inv_type,
    c.invoice_price_per_kg
    FROM invoices i
    JOIN customers c ON c.id = i.customer_id
    WHERE i.invoice_ref_no = ?
  SQL

  rec = DB[sql, inv_ref].first
  raise "Can't find invoice #{inv_ref}" if rec.nil?

  signame = if  rec[:approved]
              "#{rec[:approved_by]}.jpg"
            else
              'signnone.jpg'
            end
  jasper_params = JasperParams.new('invoice_header',
                                   'reprint',
                                   use_mass: rec[:invoice_price_per_kg],
                                   invoice_id: rec[:id],
                                   invoice_type: rec[:inv_type],
                                   customer_id: nil,
                                   signature: signame,
                                   company_name: 'Unifrutti',
                                   use_customer_varieties: false)
  # jasper_params.file_name = "#{rec[:inv_type]}_invoice_#{rec[:id]}_#{Time.now.strftime('%m_%d_%Y_%H_%M_%S')}"
  jasper_params.file_name = "#{rec[:inv_type]}_invoice_#{rec[:id]}_#{inv_ref}"
  jasper_params.mode = :pdf
  # jasper_params.parent_folder = 'unifrutti'

  res = CreateJasperReport.call(jasper_params)

  if res[:success]
    puts("Created #{res[:instance]}")
  else
    puts "Could not print Document : #{res[:msg]}"
  end
end

# print_invoice('SWI011809')
refs = %w[
  SWI013939
  SWD004470
  SWI013940
  SWD004472
  SWI013935
  SWC007644
  SWI013937
  SWD004471
  SWI014806
  SWC007706
  SWI014805
  SWC007705
  SWI014007
  SWD004787
  SWI013997
  SWD004310
  SWI014000
  SWD004313
  SWI013989
  SWD005258
  SWI014081
  SWC007550
  SWC007857
  SWI014082
  SWC007858
  SWI013932
  SWI013960
  SWD004743
  SWI013955
  SWD004568
  SWI014678
  SWD004551
  SWI014676
  SWD004547
  SWI013969
  SWD004488
  SWI014685
  SWI014688
  SWD004838
  SWI014689
  SWC007782
  SWI014686
  SWD004881
  SWI014680
  SWD004957
  SWI013975
  SWD004554
  SWI014683
  SWC007632
  SWI014687
  SWD004518
  SWI013964
  SWD004546
  SWI013953
  SWD004550
  SWI014690
  SWI013963
  SWD004545
  SWI014261
  SWI014343
  SWI014262
  SWI014263
  SWI014201
  SWD005226
  SWI014230
  SWD005131
  SWI014224
  SWI014212
  SWD005134
  SWI014209
  SWD004609
  SWI014235
  SWD004822
  SWI014221
  SWD004726
  SWI014239
  SWD005224
  SWC007573
  SWC007627
  SWI014232
  SWI014219
  SWD004961
  SWI014234
  SWD004823
  SWI014203
  SWD004717
  SWI014211
  SWI014233
  SWD004824
  SWI014238
  SWD004780
  SWC007626
  SWC007721
  SWI014231
  SWI014202
  SWD004715
  SWI014222
  SWD004727
  SWI014215
  SWD004960
  SWI014213
  SWI014337
  SWD004610
  SWI014237
  SWD005223
  SWC007572
  SWC007625
  SWI014206
  SWD004720
  SWI014204
  SWD004718
  SWI014229
  SWI014226
  SWI014225
  SWI014217
  SWD004722
  SWI014220
  SWD004723
  SWI014140
  SWD004915
  SWI014134
  SWI013933
  SWI014273
  SWD004975
  SWI014279
  SWD004880
  SWI014266
  SWD004694
  SWI014270
  SWI014276
  SWD004876
  SWI014061
  SWC007654
  SWD005011
  SWD005079
  SWI014064
  SWD004988
  SWD005099
  SWI014063
  SWD004998
  SWD005044
  SWI014062
  SWI013991
  SWI014001
  SWI014345
  SWC007182
  SWI014028
  SWI014092
  SWI014253
  SWC007535
  SWI014016
  SWI014025
  SWI014020
  SWI014024
  SWI014026
  SWI014017
  SWI014015
  SWI014018
  SWI014014
  SWI014331
  SWI014167
  SWD004910
  SWI014168
  SWD004907
  SWI014165
  SWD004755
  SWI014300
  SWI014306
  SWD004888
  SWD004889
  SWI014302
  SWD005261
  SWI014299
  SWI014298
  SWI014297
  SWI014294
  SWC007696
  SWI014310
  SWD004887
  SWI014296
  SWD004651
  SWI014308
  SWD004885
  SWI014251
  SWI014695
  SWI014386
  SWI014387
  SWI014162
  SWD004919
  SWD004922
  SWI014250
  SWD004921
  SWI014160
  SWC007566
  SWI014155
  SWC007563
  SWI014148
  SWC007364
  SWI014154
  SWC007562
  SWI014145
  SWI014161
  SWC007567
  SWI014158
  SWC007564
  SWI014159
  SWC007565
  SWI014252
  SWD005012
  SWD005080
  SWI014258
  SWD004989
  SWD005021
  SWI014256
  SWI014254
  SWI014255
  SWD005047
  SWD005000
  SWI014339
  SWC007454
  SWI014073
  SWI014548
  SWI014427
  SWI014428
  SWI014197
  SWI014195
  SWI014199
  SWI014198
  SWI014200
  SWI014194
  SWD005052
  SWI014095
  SWI014096
  SWC007571
  SWI014464
  SWC007823
  SWI014469
  SWC007828
  SWI014477
  SWC007792
  SWI014702
  SWI014482
  SWI014480
  SWI014458
  SWD004721
  SWI014474
  SWI014467
  SWI014468
  SWI014475
  SWD005277
  SWC007795
  SWI014459
  SWI014460
  SWI014463
  SWD005051
  SWI014479
  SWI014700
  SWC007829
  SWI014456
  SWI014476
  SWC007791
  SWI014478
  SWC007793
  SWI014481
  SWC007794
  SWI014701
  SWI014483
  SWC007790
  SWI014465
  SWC007822
  SWI014457
  SWI014461
  SWC007754
  SWI014462
  SWI014332
  SWI014395
  SWD004902
  SWI014398
  SWI014411
  SWD005244
  SWI014392
  SWD004899
  SWI014394
  SWD004895
  SWD004901
  SWI014391
  SWD004898
  SWI014410
  SWD005243
  SWI014396
  SWD004897
  SWI014393
  SWD004900
  SWI014390
  SWD004896
  SWI014408
  SWD004873
  SWI014407
  SWI014406
  SWI014404
  SWI014421
  SWI014368
  SWI014367
  SWD004916
  SWI014359
  SWD005270
  SWI014361
  SWD005296
  SWC007856
  SWI014365
  SWD005294
  SWC007854
  SWI014360
  SWD005295
  SWC007855
  SWI014358
  SWD005293
  SWC007853
  SWD005268
  SWI014353
  SWD004326
  SWI014355
  SWD005245
  SWI014356
  SWD005246
  SWI014354
  SWD004327
  SWI014357
  SWD005247
  SWI014372
  SWC007569
  SWI014375
  SWC007560
  SWI014373
  SWC007561
  SWI014432
  SWD005023
  SWD004990
  SWI014431
  SWD005081
  SWI014433
  SWD005048
  SWD005002
  SWI014434
  SWI014435
  SWI014340
  SWI014531
  SWI014325
  SWI014341
  SWI014350
  SWD005024
  SWI014349
  SWI014514
  SWD005053
  SWI014513
  SWD005054
  SWI014516
  SWI014518
  SWI014517
  SWC007767
  SWI014519
  SWI014515
  SWI014785
  SWI014379
  SWI014556
  SWI014423
  SWI014425
  SWI014426
  SWI014720
  SWC007802
  SWC007893
  SWI014719
  SWC007801
  SWC007894
  SWI014716
  SWC007808
  SWC007895
  SWI014576
  SWC007747
  SWI014584
  SWC007798
  SWC007896
  SWI014715
  SWC007804
  SWC007897
  SWI014711
  SWC007748
  SWI014712
  SWC007750
  SWI014718
  SWC007800
  SWC007898
  SWI014717
  SWC007799
  SWC007899
  SWI014807
  SWC007746
  SWI014581
  SWC007756
  SWI014723
  SWC007834
  SWD005292
  SWI014721
  SWC007833
  SWI014595
  SWC007830
  SWI014582
  SWC007824
  SWI014724
  SWC007786
  SWI014586
  SWC007806
  SWC007901
  SWI014585
  SWC007807
  SWC007900
  SWI014580
  SWC007755
  SWI014583
  SWC007797
  SWC007903
  SWI014591
  SWC007803
  SWC007904
  SWI014577
  SWC007749
  SWI014599
  SWC007832
  SWI014714
  SWC007751
  SWI014541
  SWI014484
  SWC007547
  SWI014485
  SWI014532
  SWI014530
  SWI014525
  SWD005055
  SWI014524
  SWD005025
  SWI014523
  SWD005083
  SWI014522
  SWI014487
  SWI014488
  SWI014507
  SWI014526
  SWI014449
  SWC007877
  SWI014650
  SWC007836
  SWI014649
  SWC007815
  SWC007815
  SWC007910
  SWI014636
  SWD005252
  SWC007758
  SWC007757
  SWI014639
  SWC007827
  SWI014652
  SWC007787
  SWI014646
  SWC007811
  SWC007911
  SWI014704
  SWC007752
  SWI014647
  SWC007814
  SWC007912
  SWI014643
  SWC007813
  SWC007909
  SWI014726
  SWC007745
  SWI014635
  SWC007744
  SWI014654
  SWC007837
  SWI014705
  SWC007753
  SWI014645
  SWC007809
  SWC007905
  SWI014707
  SWC007826
  SWI014651
  SWC007835
  SWI014708
  SWC007810
  SWC007908
  SWI014706
  SWC007825
  SWI014710
  SWC007838
  SWI014648
  SWC007812
  SWC007906
  SWI014709
  SWC007816
  SWC007907
  SWI014613
  SWD005056
  SWI014611
  SWD005084
  SWI014610
  SWD005027
  SWI014612
  SWI014557
  SWI014561
  SWI014562
  SWI014627
  SWC007772
  SWI014625
  SWI014624
  SWI014630
  SWI014629
  SWI014626
  SWI014631
  SWC007779
  SWI014628
  SWI014632
  SWC007773
  SWI014621
  SWI014745
  SWI014782
  SWI014734
  SWI014732
  SWD005028
  SWI014733
  SWD005057
  SWI014619
  SWI014607
  SWI014618
  SWI014664
  SWI014655
  SWI014665
  SWI014731
  SWI014741
  SWC007743
  SWI014751
  SWC007771
  SWI014748
  SWC007769
  SWI014752
  SWC007775
  SWI014750
  SWC007770
  SWI014747
  SWI014753
  SWC007768
  SWI014749
  SWI014784
  SWI014761
  SWI011957
  SWC006671
  SWC006725
  SWI011958
  SWC006668
  SWC006719
  SWI011959
  SWC006670
  SWC006722
  SWI011966
  SWD004017
  SWD004018
  SWC006674
  SWC006727
  SWC006739
  SWC006758
  SWC006674
  SWC006727
  SWC006740
  SWC006674
  SWC006739
  SWC006727
  SWC006758
  SWI011967
  SWC006759
  SWI011975
  SWC007006
  SWI011976
  SWC007024
  SWI011977
  SWC007018
  SWI012087
  SWC006816
  SWI012001
  SWC007008
  SWI012002
  SWC006678
  SWC006732
  SWC006745
  SWI012003
  SWC006677
  SWC006731
  SWC006746
  SWI012000
  SWI012046
  SWC006771
  SWI012047
  SWC006683
  SWC006750
  SWC006891
  SWI012061
  SWI012033
  SWC007025
  SWI012088
  SWC006818
  SWI014071
  SWC007138
  SWI012090
  SWC007021
  SWI012142
  SWC006905
  SWI012161
  SWC006906
  SWC006755
  SWC006906
  SWI012163
  SWC006900
  SWC006757
  SWC006900
  SWI012162
  SWC006903
  SWC006756
  SWC006903
  SWI012139
  SWC006898
  SWI012141
  SWI012140
  SWC006899
  SWI012143
  SWC006902
  SWI012082
  SWC006960
  SWI012105
  SWI013357
  SWC007111
  SWC007106
  SWC007110
  SWI012124
  SWC006710
  SWC006851
  SWI014088
  SWC007174
  SWI012126
  SWC006901
  SWI012128
  SWI012127
  SWC006904
  SWI012131
  SWD004162
  SWC006874
  SWI012144
  SWC007013
  SWI013109
  SWD004159
  SWC006932
  SWI012173
  SWI012181
  SWD004283
  SWC006875
  SWD004279
  SWI012190
  SWD004391
  SWC006853
  SWI012180
  SWC007448
  SWI012178
  SWD004241
  SWI012200
  SWD004276
  SWI012421
  SWI012192
  SWD004308
  SWI012191
  SWD004307
  SWI012193
  SWD004306
  SWI012175
  SWC007386
  SWC007387
  SWC007389
  SWC007388
  SWI012176
  SWI012196
  SWC007315
  SWI012195
  SWI012194
  SWI012465
  SWD004152
  SWI012466
  SWC007270
  SWD004423
  SWD004281
  SWC006854
  SWI012463
  SWD004153
  SWC006860
  SWI012467
  SWC007331
  SWC007332
  SWI014192
  SWC007175
  SWI012272
  SWI014328
  SWI012240
  SWC006908
  SWI012241
  SWC006910
  SWI012239
  SWI012238
  SWI012229
  SWI012230
  SWC007353
  SWI012254
  SWI012253
  SWI012688
  SWI012354
  SWI012213
  SWI012197
  SWC007609
  SWC006866
  SWI014106
  SWD004257
  SWI014104
  SWD004368
  SWI014107
  SWD004261
  SWD004262
  SWI014105
  SWD004378
  SWI012342
  SWD004214
  SWI013888
  SWD005286
  SWI012287
  SWC006931
  SWD004204
  SWC006855
  SWI012285
  SWD004175
  SWC006846
  SWI012289
  SWD004278
  SWI014544
  SWD005284
  SWI013889
  SWD005219
  SWI012283
  SWD004156
  SWC006861
  SWI012284
  SWD004207
  SWD004206
  SWI014769
  SWD005138
  SWD005162
  SWC007534
  SWI013887
  SWD005285
  SWI012286
  SWC007449
  SWI012349
  SWI012232
  SWI012235
  SWC007314
  SWI012231
  SWC006962
  SWI012494
  SWC006886
  SWI012491
  SWC007392
  SWC006842
  SWC007393
  SWI012493
  SWD004233
  SWI012492
  SWI012490
  SWI014143
  SWC007488
  SWC007487
  SWI012338
  SWC007484
  SWI012482
  SWI012524
  SWI012242
  SWC007217
  SWI012333
  SWI012336
  SWC007226
  SWI012332
  SWI012335
  SWC007225
  SWI012334
  SWI012441
  SWC007230
  SWI012442
  SWC007228
  SWI012440
  SWI014108
  SWD004259
  SWI014321
  SWD004254
  SWI014323
  SWI012380
  SWD004305
  SWI012293
  SWC006963
  SWI012326
  SWI012324
  SWC007633
  SWI012325
  SWI012327
  SWI012388
  SWI012543
  SWI012356
  SWD004205
  SWC006856
  SWI014101
  SWD004256
  SWI012262
  SWC007398
  SWC007399
  SWC007397
  SWI012661
  SWI012261
  SWI012260
  SWD004210
  SWI012546
  SWD004319
  SWI012390
  SWD004320
  SWI012372
  SWI012371
  SWC007402
  SWC007401
  SWC007400
  SWC007403
  SWC006808
  SWC007403
  SWD004707
  SWC006844
  SWI014338
  SWC007493
  SWC007491
  SWI014111
  SWD004687
  SWC007334
  SWC007510
  SWI013905
  SWD004840
  SWI012379
  SWD004151
  SWC006847
  SWI012385
  SWC007330
  SWI012429
  SWC007261
  SWC007559
  SWD004395
  SWC006857
  SWI012377
  SWI014114
  SWD004265
  SWI014113
  SWD004263
  SWI012658
  SWC007180
  SWI012538
  SWI012412
  SWI012411
  SWC006939
  SWI012410
  SWI012408
  SWC007316
  SWI013547
  SWI012540
  SWI012694
  SWC007511
  SWI012436
  SWD004239
  SWD004240
  SWI014773
  SWD005330
  SWI013909
  SWD004343
  SWD004277
  SWI012576
  SWD004165
  SWD004164
  SWI012437
  SWC007442
  SWI012435
  SWD004157
  SWC006863
  SWI014770
  SWD004647
  SWD005137
  SWD005163
  SWI012498
  SWD004589
  SWC006848
  SWI014146
  SWC007494
  SWI014110
  SWD004688
  SWC007335
  SWC007512
  SWI012566
  SWI012568
  SWC007107
  SWI012781
  SWD005325
  SWD005324
  SWD004502
  SWD004511
  SWD004344
  SWI013911
  SWC007892
  SWI012535
  SWC006964
  SWI012536
  SWC006965
  SWI012556
  SWD004422
  SWI012557
  SWI012555
  SWD004147
  SWI012558
  SWD004146
  SWC006938
  SWI012709
  SWI012708
  SWI012707
  SWI012710
  SWI012502
  SWC007233
  SWI012469
  SWI012470
  SWI012471
  SWI012570
  SWD004708
  SWC007147
  SWC007193
  SWI012534
  SWD004464
  SWC007266
  SWC007303
  SWI014136
  SWI014135
  SWD004365
  SWI012548
  SWD004142
  SWI014132
  SWD004268
  SWI014139
  SWD004273
  SWI014138
  SWD004271
  SWI014133
  SWD004297
  SWI014187
  SWC007358
  SWI012521
  SWD004154
  SWC006864
  SWI012620
  SWD004592
  SWC006828
  SWI012622
  SWD004290
  SWI012623
  SWC006821
  SWI012624
  SWD004766
  SWI012625
  SWD005164
  SWC007673
  SWC007674
  SWI012626
  SWD005165
  SWC007683
  SWI014763
  SWD005329
  SWI012783
  SWD004510
  SWD004578
  SWD005326
  SWI012629
  SWD004524
  SWC006825
  SWD004402
  SWI014764
  SWD005203
  SWD005205
  SWD005201
  SWI012630
  SWC007313
  SWC006826
  SWI012628
  SWC007525
  SWC007523
  SWC007524
  SWI012627
  SWD004943
  SWC007870
  SWI014775
  SWC007629
  SWI012588
  SWI012461
  SWC007232
  SWI012796
  SWC007229
  SWI012610
  SWC006824
  SWC007594
  SWC006824
  SWD004788
  SWC006824
  SWI012611
  SWI012575
  SWI014100
  SWC007544
  SWI012537
  SWI014558
  SWD004534
  SWI012942
  SWD004301
  SWI014177
  SWD004367
  SWD004533
  SWI012642
  SWD005069
  SWI012634
  SWD004219
  SWI012633
  SWD004217
  SWI012635
  SWD005132
  SWI014324
  SWD004303
  SWI014175
  SWD004956
  SWI014181
  SWD004933
  SWI014180
  SWD004939
  SWI014179
  SWD004300
  SWD004935
  SWC007476
  SWI014173
  SWD005061
  SWI012680
  SWI012613
  SWI012679
  SWI014727
  SWI012662
  SWD004420
  SWI012663
  SWD004421
  SWI012564
  SWC006966
  SWI012600
  SWC007234
  SWI012716
  SWC007236
  SWI012602
  SWC007235
  SWI012598
  SWI012660
  SWI012586
  SWD004532
  SWC006829
  SWI012737
  SWD004498
  SWI012784
  SWD005211
  SWD005212
  SWI012736
  SWC007526
  SWC007641
  SWI012785
  SWD005323
  SWD005327
  SWI012574
  SWD004945
  SWC006849
  SWI012573
  SWD004466
  SWC006831
  SWI012572
  SWC007190
  SWD004428
  SWC006827
  SWD004223
  SWI012565
  SWD004284
  SWC006830
  SWI012569
  SWD004944
  SWI012609
  SWI012751
  SWC007197
  SWI012590
  SWC007461
  SWI012597
  SWI012615
  SWI012617
  SWI012605
  SWI012743
  SWD004593
  SWI012742
  SWD004289
  SWI012744
  SWD004427
  SWI012741
  SWD004767
  SWD004768
  SWI014097
  SWC007497
  SWI012776
  SWI014089
  SWI012749
  SWC007413
  SWI012748
  SWI012652
  SWD004709
  SWC007146
  SWC007194
  SWC007195
  SWI012773
  SWI012654
  SWC007184
  SWI012659
  SWI012763
  SWD004457
  SWD004456
  SWI012765
  SWC007765
  SWI012761
  SWD004364
  SWI012764
  SWI012766
  SWI012767
  SWI012770
  SWI012762
  SWI012768
  SWI012854
  SWD004604
  SWI012668
  SWI012667
  SWI012669
  SWI013098
  SWI013070
  SWD005064
  SWI013069
  SWI013065
  SWI014043
  SWI013000
  SWD005208
  SWD005209
  SWI013006
  SWD005322
  SWD004576
  SWD004681
  SWD004577
  SWI012997
  SWD004386
  SWI012999
  SWC007538
  SWD004526
  SWI012996
  SWC007356
  SWI013001
  SWD004594
  SWI013005
  SWI012721
  SWD004527
  SWI012722
  SWC007309
  SWI013687
  SWD004689
  SWC007336
  SWC007498
  SWI012745
  SWI012739
  SWI013018
  SWI013019
  SWI012801
  SWI012757
  SWC007480
  SWI012755
  SWI012771
  SWI012904
  SWD004670
  SWI012905
  SWC007304
  SWI012898
  SWC007499
  SWI014099
  SWI012900
  SWI013037
  SWI013023
  SWD004407
  SWD004529
  SWD004425
  SWI012886
  SWD004596
  SWI012888
  SWD004288
  SWI012881
  SWD004454
  SWI012894
  SWD004465
  SWI014780
  SWC007843
  SWI013021
  SWC007643
  SWD005001
  SWI012878
  SWD005180
  SWC007688
  SWI012879
  SWD004309
  SWI012944
  SWD005320
  SWI012883
  SWD004385
  SWI012868
  SWC007645
  SWI012842
  SWI013024
  SWD004531
  SWD004569
  SWC007409
  SWC007412
  SWI012919
  SWI012918
  SWD004117
  SWI012803
  SWD004690
  SWC007337
  SWC007500
  SWI013003
  SWD004762
  SWI013004
  SWI012873
  SWC007462
  SWI014098
  SWC007502
  SWI014091
  SWI012929
  SWC007185
  SWI013111
  SWD004506
  SWI013191
  SWD004748
  SWD004749
  SWI013192
  SWI013190
  SWD004330
  SWI013112
  SWD004436
  SWI013113
  SWD004641
  SWI013042
  SWI013122
  SWC007481
  SWI013404
  SWC007186
  SWI013405
  SWI013207
  SWD004419
  SWI013204
  SWI013205
  SWD004514
  SWI013210
  SWD004418
  SWI013209
  SWD004416
  SWI013206
  SWD004417
  SWI013203
  SWI013214
  SWI013213
  SWI013211
  SWC007761
  SWI013216
  SWC007763
  SWI013368
  SWC007762
  SWI013208
  SWD004415
  SWI013212
  SWI012981
  SWD004691
  SWC007338
  SWC007503
  SWI012976
  SWI012975
  SWI012974
  SWI012978
  SWI012977
  SWI013140
  SWD004636
  SWI013012
  SWD004525
  SWI012988
  SWD004287
  SWI012989
  SWD004318
  SWD004668
  SWD004669
  SWI012991
  SWD004657
  SWD004655
  SWI014766
  SWC007891
  SWI012986
  SWD004453
  SWI012982
  SWD004400
  SWI013002
  SWD004946
  SWI014772
  SWC007889
  SWI013159
  SWC007587
  SWC007586
  SWI013145
  SWD004750
  SWD004798
  SWI013163
  SWD004509
  SWI013138
  SWD004672
  SWI013137
  SWD004618
  SWI013139
  SWD004399
  SWI014248
  SWC007505
  SWI014246
  SWI014247
  SWD004692
  SWC007339
  SWC007506
  SWI013399
  SWI013400
  SWI012933
  SWI012935
  SWI012936
  SWD004522
  SWI012937
  SWI012932
  SWI012940
  SWC007328
  SWI012941
  SWI012938
  SWI012939
  SWI013035
  SWI012979
  SWC007187
  SWI012980
  SWI013331
  SWI014164
  SWD004540
  SWD004542
  SWD004541
  SWI014163
  SWD004984
  SWI014320
  SWD004370
  SWI013142
  SWI013119
  SWI013143
  SWD004585
  SWI013026
  SWI014115
  SWD005254
  SWI014121
  SWD004833
  SWI014119
  SWD004739
  SWI013027
  SWI012994
  SWI013016
  SWC007326
  SWI013015
  SWC007325
  SWI013014
  SWC007324
  SWI013017
  SWC007327
  SWI013029
  SWI013030
  SWI013257
  SWD004187
  SWI013032
  SWI013031
  SWI013160
  SWD004188
  SWI013165
  SWI013028
  SWI013351
  SWD004821
  SWI014191
  SWD004492
  SWI014189
  SWD004484
  SWI014312
  SWD004968
  SWI014313
  SWD004490
  SWI014314
  SWD004937
  SWI013166
  SWI013104
  SWD004505
  SWI013164
  SWI013225
  SWI013226
  SWI013228
  SWD004189
  SWD004189
  SWD005097
  SWI013229
  SWI013650
  SWI013824
  SWD005117
  SWI013827
  SWI013825
  SWI013161
  SWI013294
  SWD004429
  SWI014781
  SWI013299
  SWI013293
  SWD004508
  SWI013301
  SWC007583
  SWI013303
  SWD005214
  SWI013292
  SWD005170
  SWC007681
  SWI013302
  SWD004685
  SWI013296
  SWD004644
  SWI013297
  SWI013403
  SWI013402
  SWC007220
  SWI013167
  SWI013197
  SWC007646
  SWI013383
  SWD004442
  SWI013396
  SWI013391
  SWI013380
  SWD004486
  SWI013382
  SWD004444
  SWI013388
  SWI013386
  SWD004441
  SWI013384
  SWD004443
  SWI013392
  SWI013385
  SWD005039
  SWI013378
  SWI013393
  SWI013390
  SWI013381
  SWD005043
  SWI013397
  SWI014601
  SWI013233
  SWC007507
  SWI013237
  SWD004693
  SWC007340
  SWC007508
  SWI013235
  SWC007509
  SWI013236
  SWI013266
  SWD004673
  SWD004674
  SWI013265
  SWD004507
  SWI013333
  SWC007463
  SWI013428
  SWI013246
  SWI013245
  SWD004587
  SWI013264
  SWI013358
  SWC007597
  SWI013496
  SWI013495
  SWI013484
  SWD005110
  SWI013497
  SWC007133
  SWI014520
  SWC007655
  SWI013456
  SWD004745
  SWI013440
  SWD004814
  SWI013442
  SWD004813
  SWI013449
  SWD005005
  SWI013446
  SWD004808
  SWI013443
  SWD004811
  SWI013445
  SWD004810
  SWI013455
  SWD004686
  SWI013452
  SWD004477
  SWI013453
  SWD004476
  SWI013457
  SWD004458
  SWI013430
  SWI013374
  SWC007188
  SWI013376
  SWI013377
  SWI013314
  SWD004786
  SWI013311
  SWD004473
  SWI013312
  SWD004653
  SWI013313
  SWD004869
  SWI013379
  SWI013551
  SWD004448
  SWI013554
  SWD004447
  SWI013561
  SWI013558
  SWI013563
  SWC007774
  SWC007601
  SWI013550
  SWI013552
  SWD004449
  SWI013548
  SWI013565
  SWI013765
  SWI014068
  SWD004351
  SWI013615
  SWD004359
  SWI014318
  SWD004742
  SWI014067
  SWD004353
  SWI014319
  SWD004345
  SWI013607
  SWI014283
  SWC007656
  SWI014284
  SWC007652
  SWI014286
  SWC007648
  SWI013469
  SWC007456
  SWC007457
  SWI013816
  SWI014703
  SWI013503
  SWC007859
  SWI013504
  SWI014070
  SWC007860
  SWI013501
  SWC007464
  SWI013936
  SWC007171
  SWI013679
  SWC007551
  SWI013674
  SWC007861
  SWI013675
  SWI013587
  SWD004627
  SWI013584
  SWD005318
  SWI013575
  SWC007584
  SWI013591
  SWD004625
  SWI013602
  SWD004459
  SWI013595
  SWD004806
  SWI013577
  SWI013597
  SWD004801
  SWI013599
  SWI013593
  SWD004804
  SWI013594
  SWD004805
  SWI013596
  SWD004807
  SWI013598
  SWD004802
  SWI013576
  SWI013657
  SWC007887
  SWI013592
  SWD004626
  SWI013590
  SWD004624
  SWI013601
  SWD004560
  SWI013659
  SWD004623
  SWI013582
  SWD004699
  SWI013600
  SWD004730
  SWI013604
  SWD004770
  SWI013662
  SWD005173
  SWC007667
  SWI013658
  SWD004628
  SWI013578
  SWD004697
  SWI013581
  SWI013656
  SWD005319
  SWI013583
  SWD004696
  SWI014767
  SWC007886
  SWI013580
  SWD004698
  SWI013553
  SWD004679
  SWI013559
  SWD004571
  SWI013556
  SWI014330
  SWI013427
  SWC007649
  SWI013506
  SWI014275
  SWI013623
  SWI013424
  SWI013638
  SWI013639
  SWI013994
  SWC007219
  SWI013781
  SWI013622
  SWI013573
  SWC007189
  SWI013470
  SWI013546
  SWC007876
  SWI013728
  SWI013742
  SWI013805
  SWD004753
  SWI013800
  SWD004773
  SWI013794
  SWD004469
  SWI013793
  SWD004468
  SWI013811
  SWD005176
  SWC007670
  SWI013798
  SWD004871
  SWI013799
  SWD004870
  SWI013807
  SWD004797
  SWI013802
  SWD004772
  SWI013812
  SWD005177
  SWC007668
  SWI013806
  SWD004794
  SWI013732
  SWD004562
  SWI013731
  SWD005217
  SWI013734
  SWD004841
  SWI014768
  SWD005317
  SWI013893
  SWC007885
  SWI013894
  SWD004842
  SWI013788
  SWD004854
  SWI013896
  SWD004676
  SWI013729
  SWD004999
  SWI013895
  SWD004843
  SWI013892
  SWD005215
  SWI013901
  SWD004861
  SWI013899
  SWD004859
  SWI013897
  SWD005233
  SWI013782
  SWI013680
  SWI013652
  SWD004759
  SWI014344
  SWI014535
  SWI013654
  SWI013980
  SWC007433
  SWI014316
  SWC007657
  SWI013770
  SWI013771
  SWD004757
  SWD004758
  SWI013759
  SWC007431
  SWI013786
  SWC007658
  SWI013787
  SWD005113
  SWI013784
  SWI013721
  SWI013983
  SWC007455
  SWC007458
  SWI013719
  SWC007536
  SWI013723
  SWI013992
  SWC007218
  SWI013722
  SWI013785
  SWI013724
  SWI013864
  SWC007864
  SWI013865
  SWC007552
  SWI013740
  SWI014694
  SWC007350
  SWI013863
  SWI013862
  SWI013930
  SWI014697
  SWC007650
  SWD004995
  SWI014242
  SWC007653
  SWI013752
  SWD004446
  SWI013751
  SWI013750
  SWI013753
  SWI013754
  SWI013749
  SWI013801
  SWI013924
  SWC007651
  SWD004996
  SWD005042
  SWI013923
  SWD005009
  SWD005077
  SWI013922
  SWI013921
  SWI013920
  SWD005016
  SWI013829
  SWC007465
  SWI013948
  SWC007553
  SWC007863
  SWI013947
  SWC007865
  SWI013792
  SWI014152
  SWI013870
  SWI013874
  SWI013880
  SWI013872
  SWD005049
  SWI013869
  SWI013873
  SWI013871
  SWI013875
  SWI013876
  SWI013879
  SWI013877
  SWI013847
  SWD005116
  SWI013926
  SWI014060
  SWI014142
  SWI014280
  SWI013882
  SWI013881
  SWI013884
  SWI014078
  SWI014054
  SWI014055
  SWI014053
  SWI014056
  SWI014045
  SWI014057
  SWI014501
  SWI014493
  SWI014498
  SWI014127
  SWI014500
  SWI014129
  SWI014259
  SWI014412
  SWI014413
  SWI014414
  SWI014415
  SWI014417
  SWI014418
  SWI014419
  SWI014564
  SWI014429
  SWI014430
  SWI014450
  SWI014451
  SWI014452
  SWI014453
  SWI014454
  SWI014547
  SWI014559
  SWI014560
  SWI014554
  SWI014549
  SWI014550
  SWI014566
  SWI014534
  SWI014620
  SWI014565
  SWI014567
  SWI014568
  SWI014571
  SWI014572
  SWI014573
  SWI014660
  SWI014692
  SWI014662
  SWI014730
  SWI014623
  SWD005253
  SWI014672
  SWI014755
  SWI014759
  SWI014756
  SWI014757
  SWI014758
  SWI014760
  SWI011996
  SWI011997
  SWI012055
  SWI012054
  SWI012057
  SWI012058
  SWI012059
  SWI012065
  SWI012221
  SWI012222
  SWI012305
  SWI012226
  SWI012223
  SWI012295
  SWI012297
  SWI012298
  SWI012299
  SWI012302
  SWI012304
  SWI012308
  SWI012310
  SWI012351
  SWI012312
  SWI012313
  SWI012315
  SWI012316
  SWI012318
  SWI012319
  SWI012423
  SWI012320
  SWI012323
  SWI012424
  SWI012363
  SWI012364
  SWI012365
  SWI012366
  SWI012367
  SWI012481
  SWI012483
  SWI012484
  SWI012485
  SWI012431
  SWI012432
  SWI012452
  SWI012489
  SWI012844
  SWI012827
  SWI012813
  SWI012814
  SWI012815
  SWI012816
  SWI012817
  SWI012820
  SWI012846
  SWI012869
  SWI012882
  SWI012885
  SWI012899
  SWI013043
  SWI013044
  SWI013045
  SWI013047
  SWI013048
  SWI013056
  SWI013059
  SWI013064
  SWI013066
  SWI013067
  SWI013068
  SWI013071
  SWI013072
  SWI013075
  SWI013077
  SWI013078
  SWI013364
  SWI014288
  SWI013329
  SWI013271
  SWI014290
  SWI013307
  SWI013306
  SWI013304
  SWI013251
  SWI013252
  SWI013253
  SWI013254
  SWI013255
  SWI013260
  SWI013261
  SWI013365
  SWD004251
  SWI013366
  SWD004245
  SWI013270
  SWI013272
  SWI013273
  SWI013274
  SWI013276
  SWI014291
  SWI013435
  SWI014292
  SWI013487
  SWI013517
  SWI013488
  SWI013515
  SWI013489
  SWI013516
  SWI013490
  SWI013520
  SWI013519
  SWI013748
  SWI013747
  SWI014617
  SWI014137
  SWI014616
  SWI013762
  SWI013761
  SWI013688
  SWI013699
  SWI013709
  SWI013716
  SWI013717
  SWI013776
  SWI013780
  SWI013851
  SWI013854
  SWI013856
  SWI013855
  SWI013861
  SWI013857
  SWI014615
  SWI014033
]
refs.each do |ref|
  print_invoice(ref)
end

# rubocop:enable Metrics/MethodLength
# rubocop:enable Metrics/ClassLength
